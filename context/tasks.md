# 実装計画

## フェーズ0: 開発環境準備

- [x] 0.1 プロジェクト初期化
  - [x] 0.1.1 Gitリポジトリの初期化とREADME作成
  - [x] 0.1.2 .gitignoreファイルとディレクトリ構造の作成
  - [x] 0.1.3 Docker Compose設定ファイル作成（開発用PostgreSQL）

- [x] 0.2 バックエンド環境セットアップ
  - [x] 0.2.1 Go module初期化とプロジェクト構造作成
  - [x] 0.2.2 依存関係インストール（Echo、sqlc、golang-migrate等）
  - [x] 0.2.3 開発用Makefileとエアライブリロード設定
  - [x] 0.2.4 Go言語linter・formatter設定
    - golangci-lint設定ファイル作成 (.golangci.yml)
    - gofmt・goimports設定
    - pre-commit hooks設定

- [x] 0.3 フロントエンド環境セットアップ
  - [x] 0.3.1 Next.js 15.4プロジェクト作成とTypeScript設定
  - [x] 0.3.2 Tailwind CSS設定とReact Query導入
  - [x] 0.3.3 ESLint・Prettier・コード品質ツール設定
    - ESLint (@typescript-eslint, @next/eslint-config-next)
    - Prettier設定とエディタ統合
    - Husky + lint-staged設定（コミット前チェック）

- [x] 0.4 開発環境の動作確認
  - [x] 0.4.1 PostgreSQLコンテナ起動とデータベース接続確認
  - [x] 0.4.2 GoサーバーとNext.jsサーバーの動作確認
  - [x] 0.4.3 ホットリロードとプロキシ設定の確認

## フェーズ1: データベース基盤構築

- [x] 1.1 マイグレーションシステム構築
  - [x] 1.1.1 golang-migrateとMakefileでのマイグレーション実行環境構築
  - [x] 1.1.2 ENUM型定義（event_status, application_status, skill_level等）
  - [x] 1.1.3 基本テーブル作成（users, sports, regions）

- [x] 1.2 マスタデータテーブル構築
  - [x] 1.2.1 sportsテーブル作成とマスタデータ投入
  - [x] 1.2.2 regionsテーブル作成とJISコードマスタデータ投入
  - [x] 1.2.3 マスタデータ取得用SQL/sqlc設定作成

- [ ] 1.3 メインエンティティテーブル構築
  - [ ] 1.3.1 teams, team_regionsテーブル作成
  - [ ] 1.3.2 eventsテーブル作成と検索用インデックス設定
  - [ ] 1.3.3 applications, event_commentsテーブル作成

## フェーズ2: API基盤とマスタデータ取得

- [ ] 2.1 API基盤構築
  - [ ] 2.1.1 Echo HTTPサーバーとミドルウェア設定
  - [ ] 2.1.2 CORS、ログ、エラーハンドリングミドルウェア実装
  - [ ] 2.1.3 APIレスポンス形式の統一（data/error/meta構造）

- [ ] 2.2 マスタデータAPI実装
  - [ ] 2.2.1 GET /api/v1/sports エンドポイント実装
  - [ ] 2.2.2 GET /api/v1/regions エンドポイント実装（階層クエリ対応）
  - [ ] 2.2.3 sqlc設定とマスタデータ取得クエリ実装

## フェーズ3: 認証システム構築

- [ ] 3.1 AWS Cognito設定
  - [ ] 3.1.1 Cognito User Pool作成とUser Pool Client設定
  - [ ] 3.1.2 18歳以上制限とメール認証必須の設定
  - [ ] 3.1.3 JWT公開鍵取得とトークン検証ライブラリ実装

- [ ] 3.2 認証API実装
  - [ ] 3.2.1 JWT検証ミドルウェア実装
  - [ ] 3.2.2 GET /api/v1/me エンドポイント実装（ユーザー初回upsert）
  - [ ] 3.2.3 PATCH /api/v1/me エンドポイント実装（プロフィール更新）

- [ ] 3.3 フロントエンド認証統合
  - [ ] 3.3.1 AWS Amplify Auth設定とログイン画面実装
  - [ ] 3.3.2 JWT自動ヘッダー付与とAPI呼び出し実装
  - [ ] 3.3.3 プロフィール画面とユーザー状態管理実装

## フェーズ4: チーム管理機能

- [ ] 4.1 チーム基本機能実装
  - [ ] 4.1.1 POST /api/v1/teams エンドポイント実装（チーム作成）
  - [ ] 4.1.2 GET /api/v1/teams エンドポイント実装（owner=meクエリ対応）
  - [ ] 4.1.3 GET /api/v1/teams/{id} エンドポイント実装

- [ ] 4.2 チーム権限管理実装
  - [ ] 4.2.1 オーナー権限チェック機能実装
  - [ ] 4.2.2 PATCH /api/v1/teams/{id} エンドポイント実装
  - [ ] 4.2.3 DELETE /api/v1/teams/{id} エンドポイント実装

- [ ] 4.3 チーム対応地域機能
  - [ ] 4.3.1 POST /api/v1/teams/{id}/regions エンドポイント実装
  - [ ] 4.3.2 GET /api/v1/teams/{id}/regions エンドポイント実装
  - [ ] 4.3.3 DELETE /api/v1/teams/{id}/regions/{regionCode} エンドポイント実装

- [ ] 4.4 チーム管理フロントエンド
  - [ ] 4.4.1 チーム一覧・作成画面実装
  - [ ] 4.4.2 チーム詳細・編集画面実装
  - [ ] 4.4.3 チーム対応地域設定画面実装

## フェーズ5: イベント管理機能

- [ ] 5.1 イベント基本CRUD実装
  - [ ] 5.1.1 POST /api/v1/events エンドポイント実装（必須フィールド検証）
  - [ ] 5.1.2 GET /api/v1/events/{id} エンドポイント実装
  - [ ] 5.1.3 PATCH /api/v1/events/{id} エンドポイント実装

- [ ] 5.2 イベント状態管理実装
  - [ ] 5.2.1 状態遷移バリデーション実装（OPEN→CLOSED→CANCELED）
  - [ ] 5.2.2 開始時刻後の編集禁止機能実装
  - [ ] 5.2.3 権限チェック機能実装（オーナー・作成者権限）

- [ ] 5.3 イベント検索機能実装
  - [ ] 5.3.1 GET /api/v1/events 検索エンドポイント実装
  - [ ] 5.3.2 フィルタ機能実装（競技・地域・日付・レベル・ステータス）
  - [ ] 5.3.3 ページネーション機能実装（limit/offset）

- [ ] 5.4 イベントフロントエンド実装
  - [ ] 5.4.1 イベント検索・一覧画面実装
  - [ ] 5.4.2 イベント詳細画面実装
  - [ ] 5.4.3 イベント作成・編集画面実装

## フェーズ6: 応募システム構築

- [ ] 6.1 応募基本機能実装
  - [ ] 6.1.1 POST /api/v1/events/{id}/applications エンドポイント実装
  - [ ] 6.1.2 重複応募防止機能実装（一意制約）
  - [ ] 6.1.3 GET /api/v1/events/{id}/applications エンドポイント実装（主催者のみ）

- [ ] 6.2 応募承認システム実装
  - [ ] 6.2.1 PATCH /api/v1/applications/{id} エンドポイント実装
  - [ ] 6.2.2 楽観ロックによる定員管理機能実装
  - [ ] 6.2.3 ウェイトリスト機能実装（手動運用）

- [ ] 6.3 応募フロントエンド実装
  - [ ] 6.3.1 応募ボタンと応募フォーム実装
  - [ ] 6.3.2 応募管理画面実装（主催者用）
  - [ ] 6.3.3 マイ応募一覧画面実装

## フェーズ7: コミュニケーション機能

- [ ] 7.1 イベントコメント機能実装
  - [ ] 7.1.1 POST /api/v1/events/{id}/comments エンドポイント実装
  - [ ] 7.1.2 GET /api/v1/events/{id}/comments エンドポイント実装
  - [ ] 7.1.3 PATCH /api/v1/comments/{id} エンドポイント実装（ピン留め対応）

- [ ] 7.2 承認通知システム実装
  - [ ] 7.2.1 承認時の集合詳細自動投稿機能実装
  - [ ] 7.2.2 システムメッセージ機能実装
  - [ ] 7.2.3 通知表示機能実装（アプリ内のみ）

- [ ] 7.3 コミュニケーションフロントエンド
  - [ ] 7.3.1 イベントコメント表示・投稿画面実装
  - [ ] 7.3.2 通知一覧画面実装
  - [ ] 7.3.3 リアルタイム更新機能実装（polling）

## フェーズ8: セキュリティ・通報機能

- [ ] 8.1 通報システム実装
  - [ ] 8.1.1 通報API実装（ユーザー・イベント通報）
  - [ ] 8.1.2 通報理由と詳細記録機能実装
  - [ ] 8.1.3 管理者レビュー用ログ機能実装

- [ ] 8.2 ブロック機能実装
  - [ ] 8.2.1 ユーザーブロック機能実装
  - [ ] 8.2.2 相互可視性制限機能実装
  - [ ] 8.2.3 ブロック済みユーザーの検索結果除外実装

- [ ] 8.3 セキュリティ対策実装
  - [ ] 8.3.1 入力検証とXSS対策実装
  - [ ] 8.3.2 CSRF対策とセキュリティヘッダー設定
  - [ ] 8.3.3 レート制限機能実装（アプリケーションレベル）

## フェーズ9: インフラとCI/CD構築

- [ ] 9.1 AWS CDK基盤実装
  - [ ] 9.1.1 VPC・サブネット・セキュリティグループ設定
  - [ ] 9.1.2 RDS PostgreSQL・RDS Proxy設定
  - [ ] 9.1.3 ECS Fargate・ALB・WAF設定

- [ ] 9.2 CI/CDパイプライン構築
  - [ ] 9.2.1 GitHub Actions設定（テスト・ビルド・デプロイ）
  - [ ] 9.2.2 Docker設定とECRへのプッシュ
  - [ ] 9.2.3 本番環境デプロイとヘルスチェック

- [ ] 9.3 監視・ログ設定
  - [ ] 9.3.1 CloudWatch設定とアラーム作成
  - [ ] 9.3.2 OpenTelemetry統合実装
  - [ ] 9.3.3 構造化ログとメトリクス実装

## フェーズ10: テストと最終調整

- [ ] 10.1 テスト実装
  - [ ] 10.1.1 API単体テスト実装（Go）
  - [ ] 10.1.2 フロントエンド単体テスト実装（React）
  - [ ] 10.1.3 統合テスト・E2Eテスト実装（Playwright）

- [ ] 10.2 パフォーマンス最適化
  - [ ] 10.2.1 データベースクエリ最適化とEXPLAIN実行
  - [ ] 10.2.2 フロントエンドバンドルサイズ最適化
  - [ ] 10.2.3 LCP < 2.5s、API応答 < 200msの確認

- [ ] 10.3 本番デプロイと最終確認
  - [ ] 10.3.1 本番環境へのデプロイとデータマイグレーション
  - [ ] 10.3.2 全機能の動作確認とパフォーマンステスト
  - [ ] 10.3.3 セキュリティ監査とペネトレーションテスト
