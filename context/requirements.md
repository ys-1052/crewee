# 要件定義書

## 概要

Creweeは地域のスポーツチーム代表者が練習/試合の参加者を素早く集め、プレイヤーが手軽に参加できる場を提供するスポーツ特化のマッチングプラットフォームです。チーム代表者（オーガナイザー）が施設を押さえ日程を組み、固定チーム未所属でも予定に合わせて参加したいプレイヤーとをつなぐサービスです。

## 要件

### 要件1: ユーザー認証とプロフィール管理

**ユーザーストーリー:** ユーザーとして、安全にアカウント登録とプロフィール管理を行いたい。そうすることで、プラットフォームに安心して参加できる。

#### 受け入れ基準

1. ユーザーが登録する時、システムはAWS Cognitoを使用したメール認証を必須とする
2. ユーザーが18歳未満の場合、システムは登録を拒否する
3. ユーザーが登録を完了した時、システムは名前、メール、居住地域を含むプロフィールを作成する
4. ユーザーがプロフィールを更新する時、システムは名前と居住地域の変更を検証して保存する
5. ユーザーのメールが未認証の場合、システムは主要機能へのアクセスを制限する

### 要件2: チーム作成と管理

**ユーザーストーリー:** チーム代表者として、自分のチームを作成・管理したい。そうすることで、チーム名でイベントを開催できる。

#### 受け入れ基準

1. 認証済みユーザーがチームを作成する時、システムはチーム名とスポーツ選択を必須とする
2. チームが作成された時、システムは作成者をチームオーナーに設定する
3. チームオーナーがチーム情報を編集する時、システムは名前とスポーツの更新を許可する
4. オーナー以外がチームを編集しようとした時、システムはアクセスを拒否する
5. チームオーナーがチームを削除する時、システムはチームと関連するすべてのイベントを削除する

### 要件3: イベント募集の作成と管理

**ユーザーストーリー:** チーム代表者として、イベント募集を作成したい。そうすることで、スポーツ活動の参加者を集められる。

#### 受け入れ基準

1. イベントを作成する時、システムはタイトル、競技、開始日時、都道府県、定員、レベルを必須とする
2. イベントが作成された時、システムはステータスを「募集中」に設定し、即座に検索可能にする
3. 主催者がイベントを更新する時、システムはすべてのフィールドとステータス（募集中/募集終了/キャンセル）の変更を許可する
4. イベントが募集終了に設定された時、システムは新規応募を防ぐが既存の承認は維持する
5. イベントがキャンセルされた時、システムは検索結果から除外する
6. 必須フィールドが不足している場合、システムはイベント作成を防ぐ

### 要件4: イベント検索と絞り込み

**ユーザーストーリー:** プレイヤーとして、イベントを検索・絞り込みたい。そうすることで、参加に適した活動を見つけられる。

#### 受け入れ基準

1. ユーザーがイベントを検索する時、システムは日時が近い順で結果を表示する
2. ユーザーがフィルターを適用する時、システムは競技、都道府県、日付、レベル、募集状態で絞り込む
3. ユーザーが検索結果を見る時、システムはイベントタイトル、日時、場所、定員、現在の参加者数を表示する
4. 条件に合うイベントがない時、システムは適切なメッセージを表示する
5. ユーザーがイベント詳細を見る時、システムはすべてのイベント情報と応募ボタンを表示する

### 要件5: 応募フローと承認管理

**ユーザーストーリー:** プレイヤーとして、イベントに応募したい。そうすることで、スポーツ活動に参加できる。

#### 受け入れ基準

1. ユーザーがイベントに応募する時、システムは認証を必須とし、任意でメッセージ添付を許可する
2. 応募が送信された時、システムはイベントの応募待ちリストに追加する
3. ユーザーが同じイベントに2回応募しようとした時、システムは重複応募を防ぐ
4. 定員に達した時、システムは新規応募をウェイトリストに追加する
5. ユーザーが応募をキャンセルした時、システムは定員枠を1つ空ける

### 要件6: 応募承認と参加者管理

**ユーザーストーリー:** チーム代表者として、応募を承認・却下したい。そうすることで、イベント参加者を管理できる。

#### 受け入れ基準

1. 主催者が応募を確認する時、システムは応募待ち、承認済み、却下済みの応募を表示する
2. 主催者が応募を承認する時、システムは応募者を参加者リストに移動し、集合詳細を送信する
3. 主催者が応募を却下する時、システムはステータスを更新し、応募者に通知する
4. 承認が定員を超える場合、システムは楽観ロックで承認を防ぐ
5. 定員が満員の時、システムは新規承認を無効化し、定員状況を表示する

### 要件7: 基本的なコミュニケーション機能

**ユーザーストーリー:** 参加者として、主催者や他の参加者とコミュニケーションを取りたい。そうすることで、イベント詳細を確認し、質問できる。

#### 受け入れ基準

1. ユーザーがイベントに応募する時、システムはメッセージ添付を許可する
2. 主催者が応募を承認する時、システムは集合詳細テンプレートの送信を許可する
3. ユーザーがコミュニケーションを必要とする時、システムは応募に紐づく基本的な公開メッセージ機能を提供する
4. メッセージが投稿された時、システムはイベントのコミュニケーションスレッドに表示する
5. 不適切なコンテンツが投稿された時、システムは通報とモデレーション機能を許可する

### 要件8: 通報とブロック機能

**ユーザーストーリー:** ユーザーとして、不適切な行為を通報し、問題のあるユーザーをブロックしたい。そうすることで、安全な環境を維持できる。

#### 受け入れ基準

1. ユーザーが不適切な行為に遭遇した時、システムは理由と説明付きでユーザーやイベントの通報を許可する
2. ユーザーが誰かを避けたい時、システムは相互の可視性制限付きブロック機能を許可する
3. 通報が送信された時、システムは管理者レビュー用にログを記録する
4. ユーザーがブロックされた時、システムはブロックした人からそのユーザーのイベントと応募を隠す
5. コンテンツがポリシーに違反する時、システムは禁止活動について明確なガイドラインを提供する

### 要件9: 地域とスポーツのマスタ管理

**ユーザーストーリー:** システム管理者として、スポーツと地域データを管理したい。そうすることで、ユーザーが活動を適切に分類できる。

#### 受け入れ基準

1. システムが初期化される時、アクティブ/非アクティブステータス付きの事前定義されたスポーツカテゴリを提供する
2. ユーザーが地域を選択する時、システムは階層的な都道府県と市区町村データを提供する
3. チームが作成される時、システムは対応エリア用に複数地域の関連付けを許可する
4. イベントが作成される時、システムは競技がチームの競技と一致することを検証する
5. 地域データが更新される時、システムは参照整合性を維持する

### 要件10: 通知とコミュニケーションチャネル

**ユーザーストーリー:** ユーザーとして、重要な更新や変更について適切に通知を受けたい。そうすることで、イベントの状況を把握できる。

#### 受け入れ基準

1. MVPでは、システムはアプリ内掲示板のみで通知を提供する
2. 応募承認・却下・イベント変更時、システムはアプリ内メッセージで通知する
3. ユーザーがログインした時、システムは未読通知を表示する
4. プッシュ通知とメール配信は将来機能として除外する（Won't）
5. 通知履歴は、システム内で一定期間保持する

### 要件11: システムパフォーマンスとセキュリティ

**ユーザーストーリー:** ユーザーとして、システムが高速で安全であることを望む。そうすることで、信頼して使用できる。

#### 受け入れ基準

1. ページが読み込まれる時、システムはLCP < 2.5秒を達成する
2. ユーザーがアクションを実行する時、システムは主要操作で200ms以内に応答する
3. データが送信される時、システムはHTTPS暗号化を使用する
4. ユーザーがリクエストを行う時、システムはレート制限を実装する
5. ユーザー入力を処理する時、システムはXSSとCSRF攻撃を防ぐ
